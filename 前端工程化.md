# 关键词

- rollup
- esbuild
- webpack
- vite

## vite和esbuild、rollup的关系

Vite 是一个基于浏览器原生 ES 模块的开发服务器和构建工具。在 Vite 中，Rollup 和 esbuild 分别扮演了不同的角色。

在 Vite 中，Rollup 和 esbuild 分别扮演了不同的角色。

Rollup 的主要作用：

将多个模块文件打包成一个或多个输出文件，以便在生产环境中使用。
优化代码，例如：删除无用代码（Tree Shaking）、压缩代码等。
支持多种模块格式，如：CommonJS、AMD、ESM 等。
提供插件系统，可以通过插件扩展 Rollup 的功能。
在 Vite 中，Rollup 主要用于生产环境构建。Vite 使用 Rollup 进行最终的打包和优化，以生成高性能的生产代码。

```
// Rollup 配置示例
import { defineConfig } from 'vite'
import { terser } from 'rollup-plugin-terser'

export default defineConfig({
  build: {
    rollupOptions: {
      plugins: [terser()]
    }
  }
})
```
esbuild 的主要作用：

快速地将源代码转换为浏览器可执行的代码。
支持多种模块格式，如：CommonJS、ESM 等。
支持压缩代码，如：移除空格、注释等。
在 Vite 中，esbuild 主要用于开发环境。Vite 利用 esbuild 快速进行代码转换，提高开发环境的编译速度。同时，Vite 也可以使用 esbuild 进行生产环境的代码压缩。


```
// 使用 esbuild 进行代码压缩的示例
import { defineConfig } from 'vite'
import esbuild from 'rollup-plugin-esbuild'

export default defineConfig({
  build: {
    rollupOptions: {
      plugins: [esbuild({ minify: true })]
    }
  }
})
```

# Vite

## CSS

Vite 对 CSS 的支持是开箱即用的，可以通过vite.config.js里的css属性来自定义配置项
在 CSS配置中，同样可以定义less,sass,postcss等处理器的配置

## 依赖预构建

目的：
1. COMMJS和UMD的兼容性
2. 提高页面加载性能（例如将lodash-es预构建为单个模块）

做法：
1. 自动依赖搜寻
   - 如果没有找到现有的缓存，Vite 会扫描您的源代码，并自动寻找引入的依赖项（即 "bare import"，表示期望从 node_modules 中解析），并将这些依赖项作为预构建的入口点。预打包使用 esbuild 执行，因此通常速度非常快。
   - 在服务器已经启动后，如果遇到尚未在缓存中的新依赖项导入，则 Vite 将重新运行依赖项构建过程，并在需要时重新加载页面。

2. Monorepo 和 链接依赖
3. 自定义行为
  - optimizeDeps.include
  - optimizeDeps.exclude
4. 缓存
  - 文件系统缓存
  - 浏览器缓存

## 静态资源处理

